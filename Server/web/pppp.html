<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>TMAP ÌîºÎ∂ÄÍ≥º Í≤ÄÏÉâ</title>
    <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=KnFx41yOtZRY1W20nnmw6SN1ERZqY396ZkH3TOQ4"></script>
</head>
<body>
    <h2 style="text-align:center;">ÎÇ¥ Ï£ºÎ≥Ä ÌîºÎ∂ÄÍ≥º Ï∞æÍ∏∞</h2>
    <div id="map_div" style="width: 100%; height: 500px;"></div>

    <script>
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return parseFloat(urlParams.get(name));
        }

        const lat = getQueryParam("lat") || 37.5665;
        const lon = getQueryParam("lon") || 126.9780;

        const map = new Tmapv2.Map("map_div", {
            center: new Tmapv2.LatLng(lat, lon),
            width: "100%",
            height: "500px",
            zoom: 15
        });

        // ÎÇ¥ ÏúÑÏπò ÎßàÏª§
        const myMarker = new Tmapv2.Marker({
            position: new Tmapv2.LatLng(lat, lon),
            map: map,
            iconHTML: `<div style="color:blue; font-weight:bold;">üîµ ÎÇ¥ ÏúÑÏπò</div>`
        });

        // ÌîºÎ∂ÄÍ≥º Í≤ÄÏÉâ Î∞è ÎßàÏª§ ÏÉùÏÑ±
        async function searchClinics() {
            const keyword = encodeURIComponent("ÌîºÎ∂ÄÍ≥º");
            const url = `https://apis.openapi.sk.com/tmap/pois?version=1&searchKeyword=${keyword}&searchType=all&searchtypCd=R&page=1&count=20&reqCoordType=WGS84GEO&resCoordType=WGS84GEO&centerLon=${lon}&centerLat=${lat}&radius=5`;

            try {
                const response = await fetch(url, {
                    method: "GET",
                    headers: {
                        "Accept": "application/json",
                        "appKey": "KnFx41yOtZRY1W20nnmw6SN1ERZqY396ZkH3TOQ4"
                    }
                });

                if (!response.ok) throw new Error(`API Ìò∏Ï∂ú Ïã§Ìå®: ${response.status}`);

                const data = await response.json();
                const pois = data.searchPoiInfo?.pois?.poi || [];

                pois.forEach(poi => {
                    const position = new Tmapv2.LatLng(poi.frontLat, poi.frontLon);

                    new Tmapv2.Marker({
                        position: position,
                        map: map,
                        title: poi.name
                    });

                    new Tmapv2.InfoWindow({
                        position: position,
                        content: `<div style="padding:5px; font-size:13px;">${poi.name}</div>`,
                        type: 2,
                        map: map
                    });
                });
            } catch (err) {
                console.error("‚ùå Ïò§Î•ò Î∞úÏÉù:", err);
            }
        }

        searchClinics();
    </script>
</body>
</html>
